{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n\nimport { relative as relativePath, resolve as resolvePath } from 'path';\n\nimport { spawn as gitSpawn } from '@npmcli/git';\nimport { cac } from 'cac';\nimport { getGitRoot } from 'get-roots';\nimport matter from 'gray-matter';\nimport hostedGitInfo from 'hosted-git-info';\nimport { configure as nunjucksConfigure } from 'nunjucks';\n\nimport { execCommand } from './template-filters/execCommand';\nimport { isOlderReleasedVersionGen } from './template-filters/isOlderReleasedVersion';\nimport { linesSelectedURLGen } from './template-filters/linesSelectedURL';\nimport { npmURL } from './template-filters/npmURL';\nimport { omitPackageScope, omitPackageScopeName } from './template-filters/omitPackageScope';\nimport { repoBrowseURLGen } from './template-filters/repoBrowseURL';\nimport { SetPropExtension } from './template-tags/setProp';\nimport { cachedPromise, catchError, errorMsgTag, indent, isObject, readFileAsync, writeFileAsync } from './utils';\nimport { createUnifiedDiffText } from './utils/diff';\nimport { ReleasedVersions } from './utils/repository';\n\nasync function tryReadFile(filepath: string): Promise<Buffer | undefined> {\n    return await readFileAsync(filepath).catch(() => undefined);\n}\n\nfunction tryRequire(filepath: string): unknown {\n    return catchError(() => require(resolvePath(filepath)));\n}\n\n// ----- //\n\nconst cwd = process.cwd();\nconst cwdRelativePath = relativePath.bind(null, cwd);\n\nconst nunjucksTags = [SetPropExtension];\n\nconst nunjucksFilters = {\n    omitPackageScope,\n    npmURL,\n    execCommand,\n    linesSelectedURL: linesSelectedURLGen({ cwdRelativePath }),\n};\n\ntype nunjucksRenderStringArgs = Parameters<ReturnType<typeof nunjucksConfigure>['renderString']>;\nasync function renderNunjucks(\n    templateCode: nunjucksRenderStringArgs[0],\n    templateContext: nunjucksRenderStringArgs[1],\n    nunjucksFilters: Record<\n        string,\n        (...args: [unknown, ...unknown[]]) => unknown\n    >,\n): Promise<string> {\n    const nunjucksEnv = nunjucksConfigure(cwd, {\n        autoescape: false,\n        throwOnUndefined: true,\n    });\n\n    nunjucksTags.forEach(ExtensionClass => {\n        nunjucksEnv.addExtension(ExtensionClass.name, new ExtensionClass());\n    });\n\n    Object.entries(nunjucksFilters).forEach(([filterName, filterFunc]) => {\n        nunjucksEnv.addFilter(\n            filterName,\n            (...args) => {\n                const callback = args.pop();\n                (async () => filterFunc(args.shift(), ...args))()\n                    .then(\n                        value => callback(null, value),\n                        async error => {\n                            if (error instanceof Error) {\n                                error.message = `${filterName}() filter / ${error.message}`;\n                            }\n                            throw error;\n                        },\n                    )\n                    .catch(callback);\n            },\n            true,\n        );\n    });\n\n    type renderStringReturnType = Parameters<Exclude<nunjucksRenderStringArgs[2], undefined>>[1];\n    const generateText = await new Promise<renderStringReturnType>(\n        (resolve, reject) => {\n            nunjucksEnv.renderString(\n                templateCode,\n                templateContext,\n                (error, result) => {\n                    if (error) {\n                        reject(error);\n                    } else {\n                        resolve(result);\n                    }\n                },\n            );\n        },\n    );\n    if (typeof generateText !== 'string') {\n        throw new Error(\n            'Nunjucks render failed: nunjucks.Environment#renderString() method returned a non-string value',\n        );\n    }\n\n    return generateText;\n}\n\nasync function main({ template, test }: { template: string; test: true | undefined }): Promise<void> {\n    const packageRootFullpath = cwd;\n    const templateFullpath = resolvePath(packageRootFullpath, template);\n    const destDirFullpath = packageRootFullpath;\n    const templateCodeWithFrontmatter = await readFileAsync(cwdRelativePath(templateFullpath), 'utf8');\n    const templateContext = {};\n\n    const pkgFileFullpath = resolvePath(packageRootFullpath, 'package.json');\n    const pkg = tryRequire(pkgFileFullpath);\n    if (!isObject(pkg)) {\n        console.error(errorMsgTag`Failed to read file ${cwdRelativePath(pkgFileFullpath)}`);\n    } else {\n        Object.assign(templateContext, { pkg });\n\n        const version = typeof pkg.version === 'string' ? pkg.version : '';\n        const repositoryURL = typeof pkg.repository === 'string'\n            ? pkg.repository\n            : isObject(pkg.repository) && typeof pkg.repository.url === 'string'\n            ? pkg.repository.url\n            : '';\n        const gitInfo = hostedGitInfo.fromUrl(repositoryURL);\n        if (!gitInfo) {\n            console.error(\n                `Failed to detect remote repository. `\n                    + (pkg.repository === undefined\n                        ? errorMsgTag`'repository' field does not exist in ${cwdRelativePath(pkgFileFullpath)} file.`\n                        : errorMsgTag`Unknown structure of 'repository' field in ${\n                            cwdRelativePath(pkgFileFullpath)\n                        } file: ${pkg.repository}`),\n            );\n        } else {\n            interface CommitIshKeywordArguments {\n                committish?: string;\n                commit?: string;\n                branch?: string;\n                tag?: string;\n            }\n            const getCommittish = (kwargs: CommitIshKeywordArguments): string | undefined => {\n                for (const prop of ['committish', 'commit', 'branch', 'tag'] as const) {\n                    if (typeof kwargs[prop] === 'string' && kwargs[prop]) {\n                        return kwargs[prop];\n                    }\n                }\n                return undefined;\n            };\n\n            const gitRootPath = catchError(() => getGitRoot(packageRootFullpath), packageRootFullpath);\n            const getReleasedVersions = cachedPromise(async () =>\n                await ReleasedVersions.fetch(gitInfo).catch(error => {\n                    console.error(`Failed to fetch git tags for remote repository:${\n                        error instanceof Error\n                            ? `\\n${indent(error.message)}`\n                            : errorMsgTag` ${error}`\n                    }`);\n                })\n            );\n            const getHeadCommitSha1 = cachedPromise(async () =>\n                await gitSpawn(['rev-parse', 'HEAD']).then(({ stdout }) => stdout.trim()).catch(() => null)\n            );\n            const isUseVersionBrowseURL = cachedPromise(async () => {\n                const headCommitSha1 = await getHeadCommitSha1();\n                if (!headCommitSha1) return false;\n\n                const releasedVersions = await getReleasedVersions();\n                if (!releasedVersions) return false;\n\n                const versionTag = releasedVersions.get(version);\n                if (!versionTag) return true;\n\n                return (await versionTag.fetchCommitSHA1()) === headCommitSha1;\n            });\n\n            Object.assign(templateContext, {\n                repo: {\n                    user: gitInfo.user,\n                    project: gitInfo.project,\n                    shortcut(...args: [CommitIshKeywordArguments & { semver?: string }] | []) {\n                        const kwargs = args.pop() ?? {};\n                        const committish = getCommittish(kwargs) ?? (kwargs.semver ? `semver:${kwargs.semver}` : '');\n                        return gitInfo.shortcut({ committish });\n                    },\n                },\n            });\n\n            Object.assign(nunjucksFilters, {\n                isOlderReleasedVersion: isOlderReleasedVersionGen({ getHeadCommitSha1, getReleasedVersions }),\n                repoBrowseURL: repoBrowseURLGen(\n                    { templateFullpath, gitRootPath, getCommittish, version, isUseVersionBrowseURL, gitInfo },\n                ),\n            });\n        }\n    }\n\n    const pkgLockFileFullpath = resolvePath(packageRootFullpath, 'package-lock.json');\n    const pkgLock = tryRequire(pkgLockFileFullpath);\n    if (!isObject(pkgLock)) {\n        console.error(errorMsgTag`Failed to read file ${cwdRelativePath(pkgLockFileFullpath)}`);\n    } else {\n        const { dependencies } = pkgLock;\n        if (!isObject(dependencies)) {\n            console.error(\n                errorMsgTag`Failed to read npm lockfile ${\n                    cwdRelativePath(pkgLockFileFullpath)\n                }. Reason: Invalid structure where 'dependencies' field does not exist.`,\n            );\n        } else {\n            interface DepsRecord {\n                [pkgName: string]: {\n                    name: string;\n                    version: string;\n                    v: string;\n                };\n            }\n            const deps = Object.entries(dependencies)\n                .reduce<DepsRecord>((deps, [pkgName, pkgData]) => {\n                    if (isObject(pkgData) && typeof pkgData.version === 'string') {\n                        deps[pkgName] = {\n                            name: pkgName,\n                            version: pkgData.version,\n                            v: pkgData.version,\n                        };\n                    }\n                    return deps;\n                }, {});\n            Object.assign(templateContext, { deps });\n        }\n    }\n\n    const generateFileFullpath = resolvePath(destDirFullpath, 'README.md');\n    const { content: templateCode, data: templateData } = matter(templateCodeWithFrontmatter);\n    const templateFrontmatter = templateCodeWithFrontmatter.substring(\n        0,\n        templateCodeWithFrontmatter.length - templateCode.length,\n    );\n    const dummyFrontmatter = templateFrontmatter.replace(/[^\\n]+/g, '');\n    const templateCodeWithDummyFrontmatter = dummyFrontmatter + templateCode;\n    Object.assign(templateContext, templateData);\n    const generateTextWithDummyFrontmatter = await renderNunjucks(\n        templateCodeWithDummyFrontmatter,\n        templateContext,\n        nunjucksFilters,\n    );\n    const generateText = generateTextWithDummyFrontmatter.substring(dummyFrontmatter.length);\n\n    if (test) {\n        const origReadmeContent = await tryReadFile(generateFileFullpath);\n        if (origReadmeContent && !origReadmeContent.equals(Buffer.from(generateText))) {\n            const templateFilename = cwdRelativePath(templateFullpath);\n            const generateFilename = cwdRelativePath(generateFileFullpath);\n            const coloredDiffText = createUnifiedDiffText(\n                {\n                    filename: generateFilename,\n                    oldStr: origReadmeContent.toString('utf8'),\n                    newStr: generateText,\n                    indent: ' '.repeat(2),\n                },\n            );\n            throw new Error(\n                `Do not edit '${generateFilename}' manually! You MUST edit '${templateFilename}' instead of '${generateFilename}'`\n                    + `\\n\\n${coloredDiffText}\\n`,\n            );\n        }\n    } else {\n        await writeFileAsync(cwdRelativePath(generateFileFullpath), generateText);\n    }\n}\n\n(() => {\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    const PKG: unknown = require('../package.json');\n\n    let pkgName: string | undefined;\n    let pkgVersion: string | undefined;\n    let pkgDescription = '';\n    if (isObject(PKG)) {\n        if (typeof PKG.name === 'string') pkgName = PKG.name;\n        if (typeof PKG.version === 'string') pkgVersion = PKG.version;\n        if (typeof PKG.description === 'string') pkgDescription = PKG.description;\n    }\n\n    const cli = cac(omitPackageScopeName(pkgName));\n    if (pkgVersion) cli.version(pkgVersion, '-V, -v, --version');\n    cli.help(\n        pkgDescription\n            ? sections => {\n                sections.splice(1, 0, { body: pkgDescription });\n            }\n            : undefined,\n    );\n\n    cli.option('--template <file>', 'Nunjucks template file path', { default: 'readme-template.njk' });\n    cli.option('--test', 'Test if README.md file is overwritten');\n\n    if (cli.commands.length <= 0) cli.usage('[options]');\n\n    const { options } = cli.parse();\n\n    if (options.version || options.help) return;\n\n    const unknownOptions = Object.keys(options)\n        .filter(name => name !== '--' && !cli.globalCommand.hasOption(name));\n    if (unknownOptions.length > 0) {\n        process.exitCode = 1;\n        console.error(\n            `unknown ${unknownOptions.length > 1 ? 'options' : 'option'}: ${\n                unknownOptions\n                    .map(name => /^[^-]$/.test(name) ? `-${name}` : `--${name}`)\n                    .join(' ')\n            }\\nTry \\`${cli.name} --help\\` for valid options.`,\n        );\n        return;\n    }\n\n    main({\n        template: options.template,\n        test: options.test,\n    }).catch(error => {\n        process.exitCode = 1;\n        console.error(error instanceof Error ? error.message : error);\n    });\n})();\n"]}