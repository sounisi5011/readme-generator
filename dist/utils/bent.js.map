{"version":3,"file":"bent.js","sourceRoot":"","sources":["../../src/utils/bent.ts"],"names":[],"mappings":"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","sourcesContent":["import { inspect } from 'util';\n\nimport { indent, isObject } from '.';\n\nfunction setProp(obj: unknown, propName: PropertyKey, value: unknown, enumerable = true): void {\n    Object.defineProperty(obj, propName, {\n        configurable: true,\n        enumerable,\n        writable: true,\n        value,\n    });\n}\n\nfunction isError(error: unknown, constructorName: string): error is Error & Record<PropertyKey, unknown> {\n    return error instanceof Error && error.constructor.name === constructorName;\n}\n\nfunction genErrerMessage(\n    { statusCode, headers, messageBodyStr }: {\n        statusCode: number;\n        headers: Record<PropertyKey, unknown>;\n        messageBodyStr: string;\n    },\n): string {\n    return [\n        `HTTP ${statusCode}`,\n        indent([\n            ...(\n                Object.entries(headers)\n                    .filter(([name]) => /^x-(?!(?:frame-options|content-type-options|xss-protection)$)/i.test(name))\n                    .sort(([a], [b]) => a < b ? -1 : a > b ? 1 : 0)\n                    .map(([name, value]) => `${name}: ${String(value)}`)\n            ),\n            `body:`,\n            indent(messageBodyStr),\n        ]),\n    ].join('\\n');\n}\n\nexport async function bentErrorFixer(error: unknown): Promise<never> {\n    if (\n        !(isError(error, 'StatusError')\n            && typeof error.statusCode === 'number' && typeof error.text === 'function' && isObject(error.headers))\n    ) {\n        // eslint-disable-next-line @typescript-eslint/return-await\n        return Promise.reject(error);\n    }\n\n    setProp(error, 'name', error.constructor.name, false);\n\n    const errorBody = await error.text();\n    setProp(error, 'body', errorBody);\n    delete error.text;\n    let messageBodyStr = errorBody;\n\n    if (typeof error.arrayBuffer === 'function') delete error.arrayBuffer;\n    if (typeof error.json === 'function') {\n        try {\n            Object.defineProperty(error, 'body', { value: JSON.parse(errorBody) });\n            messageBodyStr = inspect(error.body);\n        } catch {\n            //\n        }\n        delete error.json;\n    }\n\n    setProp(\n        error,\n        'message',\n        genErrerMessage({ statusCode: error.statusCode, headers: error.headers, messageBodyStr }),\n        false,\n    );\n\n    // eslint-disable-next-line @typescript-eslint/return-await\n    return Promise.reject(error);\n}\n"]}