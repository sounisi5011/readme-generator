{"version":3,"file":"diff.js","sourceRoot":"","sources":["../../src/utils/diff.ts"],"names":[],"mappings":";;;AAAA,iCAAwC;AACxC,+BAAmC;AAEnC;;;GAGG;AACH,SAAS,aAAa,CAAC,OAAe;IAClC,OAAO,cAAK,CAAC,aAAa,CAAC,CAAC,CAAC,GAAG,OAAO,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC;AAChE,CAAC;AAED,SAAgB,qBAAqB,CACjC,EACI,QAAQ,EACR,MAAM,EACN,MAAM,EACN,MAAM,GAAG,EAAE,GAMd;IAED,MAAM,QAAQ,GAAG,kBAAW,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;IAC1E,MAAM,eAAe,GAAG,QAAQ,CAAC,OAAO,CAAC,8BAA8B,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,cAAc,EAAE,EAAE;QACpG,MAAM,SAAS,GAAI,OAAkB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAChD,IAAI,SAAS,KAAK,GAAG,EAAE;YACnB,OAAO,GAAG,cAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACjC;aAAM,IAAI,SAAS,KAAK,GAAG,EAAE;YAC1B,OAAO,GAAG,cAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;SAChC;aAAM,IAAI,SAAS,KAAK,GAAG,EAAE;YAC1B,OAAO,GAAG,cAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;SAClC;QACD,OAAO,MAAM,GAAG,cAAK,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,GAAI,cAAyB,CAAC;IAC7F,CAAC,CAAC,GAAG,CAAC,cAAK,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,MAAM,qBAAqB,CAAC,CAAC;IACnE,OAAO,eAAe,CAAC;AAC3B,CAAC;AA1BD,sDA0BC","sourcesContent":["import { stderr as chalk } from 'chalk';\nimport { createPatch } from 'diff';\n\n/**\n * Inserts an escape character to apply an ANSI-escaped background color to an entire line\n * @see https://stackoverflow.com/a/39307121/4907315\n */\nfunction fullLineColor(lineStr: string): string {\n    return chalk.supportsColor ? `${lineStr}\\u001B[K` : lineStr;\n}\n\nexport function createUnifiedDiffText(\n    {\n        filename,\n        oldStr,\n        newStr,\n        indent = '',\n    }: {\n        filename: string;\n        oldStr: string;\n        newStr: string;\n        indent?: string;\n    },\n): string {\n    const diffText = createPatch(filename, oldStr, newStr).replace(/\\n$/, '');\n    const coloredDiffText = diffText.replace(/^([^\\r\\n]*)((?:\\r\\n?|\\n)?)/gm, (_, lineStr, lineTerminator) => {\n        const firstChar = (lineStr as string).charAt(0);\n        if (firstChar === '@') {\n            lineStr = chalk.cyan(lineStr);\n        } else if (firstChar === '-') {\n            lineStr = chalk.red(lineStr);\n        } else if (firstChar === '+') {\n            lineStr = chalk.green(lineStr);\n        }\n        return indent + chalk.white.bgBlack(fullLineColor(lineStr)) + (lineTerminator as string);\n    }) + (chalk.supportsColor ? '' : `\\n${indent}// end of diff text`);\n    return coloredDiffText;\n}\n"]}